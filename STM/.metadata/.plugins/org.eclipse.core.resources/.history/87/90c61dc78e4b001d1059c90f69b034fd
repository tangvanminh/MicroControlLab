/*
 * fsm_normal.c
 *
 *  Created on: Oct 14, 2022
 *      Author: MINH
 */
#include "fsm_normal.h"

int running_count = 0;
int deletion_count = 0;

void fsm_nomal_run(){
	switch (status){
	case INIT:
		red_count = 10;
		green_count = 7;
		yellow_count = 3;
		HAL_GPIO_WritePin(LED_RED1_GPIO_Port, LED_RED1_Pin, SET);
		HAL_GPIO_WritePin(LED_GREEN1_GPIO_Port, LED_GREEN1_Pin, SET);
		HAL_GPIO_WritePin(LED_YELLOW1_GPIO_Port, LED_YELLOW1_Pin, SET);

		HAL_GPIO_WritePin(LED_RED2_GPIO_Port, LED_RED2_Pin, SET);
		HAL_GPIO_WritePin(LED_GREEN2_GPIO_Port, LED_GREEN2_Pin, SET);
		HAL_GPIO_WritePin(LED_YELLOW2_GPIO_Port, LED_YELLOW2_Pin, SET);

		status = RUNNING_RED;
		setTimer0_ms(red_count*1000);
		break;
	case RUNNING_RED:
		running_count++;
		if(running_count == 1000/INTERUPTCYCLE) deletion_count ++;
		led7segBuffer[0] = (red_count - deletion_count)/10;
		led7segBuffer[1] = (red_count - deletion_count)%10;
		HAL_GPIO_WritePin(LED_RED1_GPIO_Port, LED_RED1_Pin, RESET);
		HAL_GPIO_WritePin(LED_GREEN1_GPIO_Port, LED_GREEN1_Pin, SET);
		HAL_GPIO_WritePin(LED_YELLOW1_GPIO_Port, LED_YELLOW1_Pin, SET);

		if(deletion_count <= green_count){
			led7segBuffer[2] = (green_count - deletion_count) /10;
			led7segBuffer[2] = (green_count - deletion_count) %10;
		}else if(deletion_count <= green_count + yellow_count){
			led7segBuffer[2] = (green_count + yellow_count - deletion_count) /10;
			led7segBuffer[2] = (green_count + yellow_count - deletion_count) %10;
		}
		break;
	case RUNNING_GREEN:
		break;
	case RUNNING_YELLOW:
		break;
	default:
		break;
	}
}

