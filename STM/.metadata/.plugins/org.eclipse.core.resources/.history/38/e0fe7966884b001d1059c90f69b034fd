/*
 * button.c
 *
 *  Created on: Oct 14, 2022
 *      Author: MINH
 */
#include "button.h"

int button0_flag = 0;
int button1_flag = 0;
int button2_flag = 0;

int button0_press_count = 100;
int button1_press_count = 100;
int button2_press_count = 100;


int debounceButtonBuffer1[NUM_OF_BUTTONS];
int debounceButtonBuffer2[NUM_OF_BUTTONS];
int debounceButtonBuffer3[NUM_OF_BUTTONS];

void getKeyInput(){
	// BUTTON 0: MODE BUTTON
	debounceButtonBuffer1[0] = debounceButtonBuffer2[0];
	debounceButtonBuffer2[0] = debounceButtonBuffer3[0];
	debounceButtonBuffer3[0] = HAL_GPIO_ReadPin(MODE_BUTTON_GPIO_Port,MODE_BUTTON_Pin);

	if(debounceButtonBuffer1[0]==debounceButtonBuffer2[0]
	   && debounceButtonBuffer2[0] == debounceButtonBuffer3[0]){
		if(debounceButtonBuffer3[0] == BUTTON_PRESSED){
			button0_flag = 1;
			button0_press_count--;
			if(button0_press_count == 0){
				button0_press_count = 25;
				debounceButtonBuffer3[0] = BUTTON_RELEASED;
			}
		}
	}else{
		if(button0_press_count != 25 && button0_press_count != 100){
			button0_press_count = 100;
		}
	}

	//BUTTON 1: ADJUST BUTTON
	debounceButtonBuffer1[1] = debounceButtonBuffer2[1];
	debounceButtonBuffer2[1] = debounceButtonBuffer3[1];
	debounceButtonBuffer3[1] = HAL_GPIO_ReadPin(ADJUST_BUTTON_GPIO_Port,ADJUST_BUTTON_Pin);

	if(debounceButtonBuffer1[1]==debounceButtonBuffer2[1]
	   && debounceButtonBuffer2[1] == debounceButtonBuffer3[1]){
		if(debounceButtonBuffer3[1] == BUTTON_PRESSED){
			button1_flag = 1;
			button1_press_count--;
			if(button1_press_count == 0){
				button1_press_count = 25;
				debounceButtonBuffer3[1] = BUTTON_RELEASED;
			}
		}
	}else{
		if(button1_press_count != 25 && button1_press_count != 100){
			button1_press_count = 100;
		}
	}

}

