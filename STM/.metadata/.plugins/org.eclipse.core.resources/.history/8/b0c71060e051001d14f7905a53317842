/*
 * fsm_adjust.c
 *
 *  Created on: Oct 14, 2022
 *      Author: MINH
 */
#include "fsm_adjust.h"

void fsm_adjust_run(){
	switch (status){
	case ADJUST_RED:
		//todo
		led7segBuffer[0] = 0;
		led7segBuffer[1] = 2;
		led7segBuffer[2] = increasing_num/10;
		led7segBuffer[3] = increasing_num%10;

		if(timer1_flag==1){
			setTimer1_ms(250);
			HAL_GPIO_TogglePin(GPIOA, LED_RED1_Pin);
			HAL_GPIO_TogglePin(GPIOA, LED_RED2_Pin);
		}

		if(button0_flag == 1){
			button0_flag = 0;
			increasing_num = 1;
			status = ADJUST_GREEN;
			HAL_GPIO_WritePin(LED_RED1_GPIO_Port, LED_RED1_Pin, SET);
			HAL_GPIO_WritePin(LED_GREEN1_GPIO_Port, LED_GREEN1_Pin, RESET);
			HAL_GPIO_WritePin(LED_YELLOW1_GPIO_Port, LED_YELLOW1_Pin, SET);

			HAL_GPIO_WritePin(LED_RED2_GPIO_Port, LED_RED2_Pin, SET);
			HAL_GPIO_WritePin(LED_GREEN2_GPIO_Port, LED_GREEN2_Pin, RESET);
			HAL_GPIO_WritePin(LED_YELLOW2_GPIO_Port, LED_YELLOW2_Pin, SET);
		}
		break;
	case ADJUST_GREEN:
		//todo

		led7segBuffer[0] = 0;
		led7segBuffer[1] = 3;
		led7segBuffer[2] = increasing_num/10;
		led7segBuffer[3] = increasing_num%10;

		if(timer1_flag==1){
			setTimer1_ms(250);
			HAL_GPIO_TogglePin(GPIOA, LED_GREEN1_Pin);
			HAL_GPIO_TogglePin(GPIOA, LED_GREEN2_Pin);
		}

		if(button0_flag == 1){
			button0_flag = 0;
			increasing_num = 1;
			status = ADJUST_YELLOW;
			HAL_GPIO_WritePin(LED_RED1_GPIO_Port, LED_RED1_Pin, SET);
			HAL_GPIO_WritePin(LED_GREEN1_GPIO_Port, LED_GREEN1_Pin, SET);
			HAL_GPIO_WritePin(LED_YELLOW1_GPIO_Port, LED_YELLOW1_Pin, RESET);

			HAL_GPIO_WritePin(LED_RED2_GPIO_Port, LED_RED2_Pin, SET);
			HAL_GPIO_WritePin(LED_GREEN2_GPIO_Port, LED_GREEN2_Pin, SET);
			HAL_GPIO_WritePin(LED_YELLOW2_GPIO_Port, LED_YELLOW2_Pin, RESET);
		}
		break;
	case ADJUST_YELLOW:
		//todo
		if(button0_flag == 1){
			button0_flag = 0;
			status = RUNNING_RED;
			setTimer0_ms(red_count*1000);
		}
		break;
	default:
		break;
	}
}

